<!DOCTYPE html><html lang="zn-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>pstree | 闲庭杂记</title><meta name="author" content="Confetti-lxy"><meta name="copyright" content="Confetti-lxy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="操作系统（JYY）oslab M1">
<meta property="og:type" content="article">
<meta property="og:title" content="pstree">
<meta property="og:url" content="http://blog.confetti-lxy.com/2023/04/28/pstree/index.html">
<meta property="og:site_name" content="闲庭杂记">
<meta property="og:description" content="操作系统（JYY）oslab M1">
<meta property="og:locale" content="zn_CN">
<meta property="og:image" content="http://blog.confetti-lxy.com/img/cover/cover-01.png">
<meta property="article:published_time" content="2023-04-28T15:10:48.000Z">
<meta property="article:modified_time" content="2023-04-28T16:50:30.737Z">
<meta property="article:author" content="Confetti-lxy">
<meta property="article:tag" content="courses">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.confetti-lxy.com/img/cover/cover-01.png"><link rel="shortcut icon" href="/img/common/favicon.ico"><link rel="canonical" href="http://blog.confetti-lxy.com/2023/04/28/pstree/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'pstree',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-29 00:50:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = 'hidden';
    document.getElementById('loading-box').classList.remove("loaded")
  }
}

preloader.initLoading()
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/common/avatar.png" onerror="onerror=null;src='/img/common/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/OS/OS-1.jpeg')"><nav id="nav"><span id="blog-info"><a href="/" title="闲庭杂记"><span class="site-name">闲庭杂记</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">pstree</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-04-28T15:10:48.000Z" title="Created 2023-04-28 23:10:48">2023-04-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-04-28T16:50:30.737Z" title="Updated 2023-04-29 00:50:30">2023-04-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AF%BE%E7%A8%8B%EF%BC%9A-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">课程： 操作系统</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">2.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>10min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="pstree"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>这是对22-23年秋季学期南京大学操作系统课程的Lab作业，这边为蒋炎岩老师班的课程。</p>
<p>本博客是对OS Lab M1的编程实验的个人的部分解答。</p>
<p>注意：这不是非官方答案，不完全正确，仅适当参考。</p>
<p>注意：请勿直接复制粘贴，否则后果自负。</p>
<hr />
<ul>
<li><p>Some of us get dipped in flat some in satin some in gloss. But
every once in a while you find someone who’s iridescent. And when you do
nothing will ever compare.</p></li>
<li><p>有的人黯淡浅薄，有的人光彩万丈，有的人败絮藏心，而当你无意间邂逅，一个灿若虹霓的人，自此之后，世间只得一个她。</p></li>
<li><p>He knew exactly what it meant about the whole being greater than
the sum of its parts. He said it was the same with people but sometimes
with people, the whole could be less.</p></li>
</ul>
<hr />
<p>课程主页： http://jyywiki.cn/OS/2023/</p>
<p>M1实验主页： http://jyywiki.cn/OS/2023/labs/M1</p>
<h5 id="整体思路">整体思路：</h5>
<p>实现的整体思路在实验主页已经较为详细的描述：</p>
<ol type="1">
<li>得到命令行的参数，根据要求设置标志变量的数值；</li>
<li>得到系统中所有进程的编号 (每个进程都会有唯一的编号)
保存到列表里；</li>
<li>对列表里的每个编号，得到它的的父亲是谁；</li>
<li>在内存中把树建好，按命令行参数要求排序；</li>
<li>把树打印到终端上。</li>
</ol>
<p>因此我们需要做的便是逐项完成上面的要求。</p>
<h5
id="首先为了方便debug构造了一个较为详细的assert断言">首先，为了方便debug，构造了一个较为详细的Assert断言：</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> RED <span class="string">&quot;\33[1;33m&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ORI <span class="string">&quot;\33[0m&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Assert(_con, _fmt, ...)                                                  	    \ </span></span><br><span class="line">	<span class="keyword">do</span>                                                                            	    \ </span><br><span class="line">	&#123;                                                                             	    \ </span><br><span class="line">		<span class="keyword">if</span> (!(_con))                                                              	      \ </span><br><span class="line">		&#123;                                                                             	  \ </span><br><span class="line">			<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, RED <span class="string">&quot;Assertion failed:\nLine:%d&quot;</span>_fmt, __LINE__, ##__VA_ARGS__); \</span><br><span class="line">			assert(<span class="number">0</span>);                                                                      \</span><br><span class="line">		&#125;                                                                                 \</span><br><span class="line">	&#125; <span class="keyword">while</span> (<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>可以在之后的细节的实现的过程中，通过插入大量的Assert来定位bug</p>
<p>然后便按照给出的提示来进行内容的实现：</p>
<h5
id="得到命令行的参数根据要求设置标志变量的数值这部分的内容较为简单只需要对argc和argv参数进行分析即可">得到命令行的参数，根据要求设置标志变量的数值，这部分的内容较为简单，只需要对argc和argv参数进行分析即可：</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">bool</span> isP = <span class="literal">false</span>; <span class="comment">// Determine whether there is -p or --show-pids in the command line</span></span><br><span class="line">	<span class="type">bool</span> isN = <span class="literal">false</span>; <span class="comment">// Determine whether there is -n or --numeric-sort in the command line</span></span><br><span class="line">	<span class="type">bool</span> isV = <span class="literal">false</span>; <span class="comment">// Determine whether there is -V or --version in the command line</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; argc; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		Output command line parameters</span></span><br><span class="line"><span class="comment">		assert(argv[i]);</span></span><br><span class="line"><span class="comment">		printf(&quot;argv[%d] = %s\n&quot;, i, argv[i]);</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// Judge whether the -p or --show-pids instruction appears</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-p&quot;</span>) || !<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--show-pids&quot;</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			isP = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Judge whether the -n or --numeric-sort instruction appears</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-n&quot;</span>) || !<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--numeric-sort&quot;</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			isN = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Judge whether the -V or --version instruction appears</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;-V&quot;</span>) || !<span class="built_in">strcmp</span>(argv[i], <span class="string">&quot;--version&quot;</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			isV = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">			In case of illegal instructions,</span></span><br><span class="line"><span class="comment">			the program is forced to end to increase the robustness of the grogram</span></span><br><span class="line"><span class="comment">			*/</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Unsupported arg(s):&quot;</span> RED <span class="string">&quot;%s\n&quot;</span> ORI, argv[i]);</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	Checkpoint one: the correct of isP, isN, isV</span></span><br><span class="line"><span class="comment">	printf(&quot;%d %d %d \n&quot;, isP, isN, isV);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// assert(!argv[argc]);</span></span><br><span class="line">	<span class="keyword">if</span> (isV)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// Output version number</span></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;pstree (PSmisc) 1.0 CopyRight (C) 2023 Confetti-lxy\n&quot;</span>);</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;PSmisc 不提供任何保证。\n&quot;</span>);</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;该程序为自由软件，欢迎你在 GNU 通用公共许可证 (GPL) 下重新发布。\n&quot;</span>);</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;详情可参阅 COPYING 文件。\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		getCourseTree();</span><br><span class="line">		sortCourseTree(isN);</span><br><span class="line">		printCourseTree(isP, root, <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5
id="得到系统中所有进程的编号-每个进程都会有唯一的编号-保存到列表里">得到系统中所有进程的编号
(每个进程都会有唯一的编号) 保存到列表里</h5>
<ul>
<li>“/proc/[pid]/stat”<strong>存储了当前进程的名字，状态，PID和PPID等信息</strong>。
<code>stat</code>是“机器版本”，还有一个人类可读版本，”/proc/[pid]/status”,此处不再赘述。具体参考：https://stackoverflow.com/questions/39066998/what-are-the-meaning-of-values-at-proc-pid-stat</li>
</ul>
<p>通过以上的了解，便可以较为轻松的完成对进程的读取</p>
<p>先定义需要的几个结构体：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">subprocessNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">pid_t</span> subprocessNodePid;</span><br><span class="line">	<span class="type">char</span> fileName[<span class="number">512</span>];</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	A structure dedicated to sorting,</span></span><br><span class="line"><span class="comment">	which can satisfy the sorting of process number and process name</span></span><br><span class="line"><span class="comment">	subprocessNodePid: The pid of the child node</span></span><br><span class="line"><span class="comment">	fileName: The name of the file</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">courseNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">char</span> fileName[<span class="number">512</span>];</span><br><span class="line">	<span class="type">pid_t</span> pid;</span><br><span class="line">	<span class="type">pid_t</span> ppid;</span><br><span class="line">	<span class="type">int</span> subprocessCount;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">subprocessNode</span> <span class="title">subprocessNodes</span>[512];</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">courseNode</span> *<span class="title">next</span>;</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	Construction of data structure of process node:</span></span><br><span class="line"><span class="comment">	fileName: The name of the file</span></span><br><span class="line"><span class="comment">	pid: the pid_t of the process</span></span><br><span class="line"><span class="comment">	ppid:the father process number of this process</span></span><br><span class="line"><span class="comment">	subprocessCount: the number of subprocesses</span></span><br><span class="line"><span class="comment">	subprocessNodes: An array that stores pids and names of the child node</span></span><br><span class="line"><span class="comment">	next: Linked list structure, pointing to the next independent process</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后便是对文件夹内容的读取函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">getCourseTree</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dirent</span> *<span class="title">entry</span>;</span></span><br><span class="line">	DIR *dirp;</span><br><span class="line">	FILE *fp;</span><br><span class="line">	Assert((dirp = opendir(<span class="string">&quot;/proc&quot;</span>)), <span class="string">&quot;Can not open /proc\n&quot;</span>); <span class="comment">// Get file directory</span></span><br><span class="line">	<span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		entry = readdir(dirp);</span><br><span class="line">		<span class="comment">// If it is empty, the traversal will be ended</span></span><br><span class="line">		<span class="keyword">if</span> (entry == <span class="literal">NULL</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		If it is not empty,</span></span><br><span class="line"><span class="comment">		judge whether it is a directory and whether the name is a number</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="keyword">if</span> (entry-&gt;d_type == <span class="number">4</span> &amp;&amp; isAllNumString(entry-&gt;d_name))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">			d_type == 4 means this is a directory</span></span><br><span class="line"><span class="comment">			isAllNumString(d_name) == true means</span></span><br><span class="line"><span class="comment">			the name of this directory consists of numbers</span></span><br><span class="line"><span class="comment">			*/</span></span><br><span class="line">			<span class="type">char</span> statPath[<span class="number">512</span>] = <span class="string">&quot;/proc/&quot;</span>;</span><br><span class="line">			<span class="comment">// Complete the acquisition of stat file address</span></span><br><span class="line">			<span class="built_in">strcat</span>(statPath, entry-&gt;d_name), <span class="built_in">strcat</span>(statPath, <span class="string">&quot;/stat&quot;</span>);</span><br><span class="line">			Assert((fp = fopen(statPath, <span class="string">&quot;r&quot;</span>)), <span class="string">&quot;Can not open %s\n&quot;</span>, statPath); <span class="comment">// Open the stat file</span></span><br><span class="line">			<span class="class"><span class="keyword">struct</span> <span class="title">courseNode</span> *<span class="title">cur</span>;</span></span><br><span class="line">			<span class="comment">// Conduct classification discussion based on whether the name is 1</span></span><br><span class="line">			<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(entry-&gt;d_name, <span class="string">&quot;1&quot;</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				cur = root;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// Avoid stackOverflow</span></span><br><span class="line">				Assert((cur = (<span class="keyword">struct</span> courseNode *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> courseNode))),</span><br><span class="line">					   <span class="string">&quot;malloc size for process failed&quot;</span>);</span><br><span class="line">				tail-&gt;next = cur, tail = tail-&gt;next;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// Write to content</span></span><br><span class="line">			<span class="built_in">fscanf</span>(fp, <span class="string">&quot;%d (%s %*c %d&quot;</span>, &amp;cur-&gt;pid, cur-&gt;fileName, &amp;cur-&gt;ppid);</span><br><span class="line">			cur-&gt;fileName[<span class="built_in">strlen</span>(cur-&gt;fileName) - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>, fclose(fp);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Traverse the linked list and write the pid of the child process</span></span><br><span class="line">	<span class="comment">// into the child process array of the parent process</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">struct</span> courseNode *head = root; head != <span class="literal">NULL</span>; head = head-&gt;next)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">struct</span> courseNode *cur = head; cur != <span class="literal">NULL</span>; cur = cur-&gt;next)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (cur != head &amp;&amp; cur-&gt;ppid == head-&gt;pid)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="type">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">				<span class="comment">// If it already exists, modify the process name to the same</span></span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; head-&gt;subprocessCount; i++)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (head-&gt;subprocessNodes[i].subprocessNodePid == cur-&gt;pid)</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="built_in">strcpy</span>(head-&gt;subprocessNodes[i].fileName, cur-&gt;fileName);</span><br><span class="line">						flag = <span class="literal">true</span>;</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// Otherwise, write it to the array</span></span><br><span class="line">				<span class="keyword">if</span> (!flag)</span><br><span class="line">				&#123;</span><br><span class="line">					head-&gt;subprocessNodes[head-&gt;subprocessCount].subprocessNodePid = cur-&gt;pid;</span><br><span class="line">					<span class="built_in">strcpy</span>(head-&gt;subprocessNodes[head-&gt;subprocessCount].fileName, cur-&gt;fileName);</span><br><span class="line">					head-&gt;subprocessCount++;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// Prevent overflow and increase robustness</span></span><br><span class="line">				Assert((head-&gt;subprocessCount &lt;= <span class="number">512</span>), <span class="string">&quot;Too many processes to fully load\n&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5
id="对列表里的每个编号得到它的的父亲是谁">对列表里的每个编号，得到它的的父亲是谁</h5>
<p>在第二步中其实已经完成了对进程号的获取和其父进程的获取，但需要注意的是，这边并未构建进程的树状结构，我是选择在打印的时候直接进行便利（虽然这样会浪费大量的时间在无意义的查找上，但是由于进程的数量有限，因此对时间的浪费总量还是较少的。注：但相对而言还是较多的）</p>
<h5
id="在内存中把树建好按命令行参数要求排序">在内存中把树建好，按命令行参数要求排序</h5>
<p>排序就没有什么特别需要描述的了，函数如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sort</span><span class="params">(<span class="keyword">struct</span> subprocessNode *nums, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	Because the amount of data is not large,</span></span><br><span class="line"><span class="comment">	the simplest bubble sorting can be used</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; len - <span class="number">1</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">strcmp</span>(nums[j].fileName, nums[j + <span class="number">1</span>].fileName) &gt; <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="type">pid_t</span> tmp1 = nums[j].subprocessNodePid;</span><br><span class="line">				nums[j].subprocessNodePid = nums[j + <span class="number">1</span>].subprocessNodePid;</span><br><span class="line">				nums[j + <span class="number">1</span>].subprocessNodePid = tmp1;</span><br><span class="line">				<span class="type">char</span> tmp2[<span class="number">512</span>];</span><br><span class="line">				<span class="built_in">strcpy</span>(tmp2, nums[j].fileName);</span><br><span class="line">				<span class="built_in">strcpy</span>(nums[j].fileName, nums[j + <span class="number">1</span>].fileName);</span><br><span class="line">				<span class="built_in">strcpy</span>(nums[j + <span class="number">1</span>].fileName, tmp2);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">sortCourseTree</span><span class="params">(<span class="type">bool</span> isNModel)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	Because it is sorted by process number by default,</span></span><br><span class="line"><span class="comment">	it only needs to be processed when sorting by process name</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">if</span> (isNModel == <span class="literal">false</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">courseNode</span> *<span class="title">head</span> =</span> root;</span><br><span class="line">		<span class="keyword">while</span> (head != <span class="literal">NULL</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			sort(head-&gt;subprocessNodes, head-&gt;subprocessCount), head = head-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="把树打印到终端上">把树打印到终端上</h5>
<p>打印过程也没什么好说的，我由于没有建树，因此在打印的过程需要额外添加搜索的过程，其他就没什么特殊的了。</p>
<p>由于构造完善的树状打印过于耗时，因此这边选择直接用缩紧来区分父子进程</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">printCourseTree</span><span class="params">(<span class="type">bool</span> isPModel, <span class="keyword">struct</span> courseNode *r, <span class="type">int</span> level)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; level; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\t&quot;</span>); <span class="comment">// Indent the relationship of processes</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Select the output mode according to the value of isPModel</span></span><br><span class="line">	<span class="keyword">if</span> (isPModel)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s(%d)\n&quot;</span>, r-&gt;fileName, r-&gt;pid); <span class="comment">// Only output process name</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// Output both process name and process numbers</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, r-&gt;fileName);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Recursive output subprocess</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; r-&gt;subprocessCount; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">courseNode</span> *<span class="title">node</span> =</span> find(r-&gt;subprocessNodes[i].subprocessNodePid);</span><br><span class="line">		<span class="keyword">if</span> (node != <span class="literal">NULL</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			printCourseTree(isPModel, node, level + <span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="总结">总结</h5>
<p>将上述内容进行组合，便可以完成对pstree的构造。</p>
<p>当然这样的实现不一样是最优的，我为了可读性和可理解性牺牲了大量的效率，但个人认为这是相对而言可接受的。</p>
<p>此外可以考虑去看一看busybox里面对pstree的实现（某种意义上算不算作弊（大雾））</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Confetti-lxy">Confetti-lxy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://blog.confetti-lxy.com/2023/04/28/pstree/">http://blog.confetti-lxy.com/2023/04/28/pstree/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/courses/">courses</a></div><div class="post_share"><div class="social-share" data-image="/img/cover/cover-01.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/04/29/plcs/" title="plcs"><img class="cover" src="/img/cover/cover-09.jpeg" onerror="onerror=null;src='/img/common/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">plcs</div></div></a></div><div class="next-post pull-right"><a href="/2023/04/28/Algorithm-Design-and-Analysis-03/" title="Algorithm Design and Analysis-03"><img class="cover" src="/img/cover/cover-11.jpeg" onerror="onerror=null;src='/img/common/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Algorithm Design and Analysis-03</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/04/28/Algorithm-Design-and-Analysis-01/" title="Algorithm Design and Analysis-01"><img class="cover" src="/img/cover/cover-10.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-28</div><div class="title">Algorithm Design and Analysis-01</div></div></a></div><div><a href="/2023/04/28/Algorithm-Design-and-Analysis-02/" title="Algorithm Design and Analysis-02"><img class="cover" src="/img/cover/cover-14.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-28</div><div class="title">Algorithm Design and Analysis-02</div></div></a></div><div><a href="/2023/04/28/Algorithm-Design-and-Analysis-03/" title="Algorithm Design and Analysis-03"><img class="cover" src="/img/cover/cover-11.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-28</div><div class="title">Algorithm Design and Analysis-03</div></div></a></div><div><a href="/2023/04/29/plcs/" title="plcs"><img class="cover" src="/img/cover/cover-09.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-29</div><div class="title">plcs</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/common/avatar.png" onerror="this.onerror=null;this.src='/img/common/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Confetti-lxy</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Confetti-lxy"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Confetti-lxy" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:3038454387@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">总要记些什么证明我来过</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%80%9D%E8%B7%AF"><span class="toc-number">1.</span> <span class="toc-text">整体思路：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E4%B8%BA%E4%BA%86%E6%96%B9%E4%BE%BFdebug%E6%9E%84%E9%80%A0%E4%BA%86%E4%B8%80%E4%B8%AA%E8%BE%83%E4%B8%BA%E8%AF%A6%E7%BB%86%E7%9A%84assert%E6%96%AD%E8%A8%80"><span class="toc-number">2.</span> <span class="toc-text">首先，为了方便debug，构造了一个较为详细的Assert断言：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BE%97%E5%88%B0%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%9A%84%E5%8F%82%E6%95%B0%E6%A0%B9%E6%8D%AE%E8%A6%81%E6%B1%82%E8%AE%BE%E7%BD%AE%E6%A0%87%E5%BF%97%E5%8F%98%E9%87%8F%E7%9A%84%E6%95%B0%E5%80%BC%E8%BF%99%E9%83%A8%E5%88%86%E7%9A%84%E5%86%85%E5%AE%B9%E8%BE%83%E4%B8%BA%E7%AE%80%E5%8D%95%E5%8F%AA%E9%9C%80%E8%A6%81%E5%AF%B9argc%E5%92%8Cargv%E5%8F%82%E6%95%B0%E8%BF%9B%E8%A1%8C%E5%88%86%E6%9E%90%E5%8D%B3%E5%8F%AF"><span class="toc-number">3.</span> <span class="toc-text">得到命令行的参数，根据要求设置标志变量的数值，这部分的内容较为简单，只需要对argc和argv参数进行分析即可：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BE%97%E5%88%B0%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%89%80%E6%9C%89%E8%BF%9B%E7%A8%8B%E7%9A%84%E7%BC%96%E5%8F%B7-%E6%AF%8F%E4%B8%AA%E8%BF%9B%E7%A8%8B%E9%83%BD%E4%BC%9A%E6%9C%89%E5%94%AF%E4%B8%80%E7%9A%84%E7%BC%96%E5%8F%B7-%E4%BF%9D%E5%AD%98%E5%88%B0%E5%88%97%E8%A1%A8%E9%87%8C"><span class="toc-number">4.</span> <span class="toc-text">得到系统中所有进程的编号
(每个进程都会有唯一的编号) 保存到列表里</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E5%88%97%E8%A1%A8%E9%87%8C%E7%9A%84%E6%AF%8F%E4%B8%AA%E7%BC%96%E5%8F%B7%E5%BE%97%E5%88%B0%E5%AE%83%E7%9A%84%E7%9A%84%E7%88%B6%E4%BA%B2%E6%98%AF%E8%B0%81"><span class="toc-number">5.</span> <span class="toc-text">对列表里的每个编号，得到它的的父亲是谁</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E6%8A%8A%E6%A0%91%E5%BB%BA%E5%A5%BD%E6%8C%89%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E8%A6%81%E6%B1%82%E6%8E%92%E5%BA%8F"><span class="toc-number">6.</span> <span class="toc-text">在内存中把树建好，按命令行参数要求排序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8A%8A%E6%A0%91%E6%89%93%E5%8D%B0%E5%88%B0%E7%BB%88%E7%AB%AF%E4%B8%8A"><span class="toc-number">7.</span> <span class="toc-text">把树打印到终端上</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/05/30/DataScience/" title="DataScience"><img src="/img/cover/cover-12.jpeg" onerror="this.onerror=null;this.src='/img/common/404.jpg'" alt="DataScience"/></a><div class="content"><a class="title" href="/2023/05/30/DataScience/" title="DataScience">DataScience</a><time datetime="2023-05-30T10:58:51.000Z" title="Created 2023-05-30 18:58:51">2023-05-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/18/Power-Gap-Predictionplcs/" title="Power Gap Predictionplcs"><img src="/img/cover/cover-03.jpg" onerror="this.onerror=null;this.src='/img/common/404.jpg'" alt="Power Gap Predictionplcs"/></a><div class="content"><a class="title" href="/2023/05/18/Power-Gap-Predictionplcs/" title="Power Gap Predictionplcs">Power Gap Predictionplcs</a><time datetime="2023-05-18T08:16:35.000Z" title="Created 2023-05-18 16:16:35">2023-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/16/reptile-01/" title="reptile-01"><img src="/img/cover/cover-03.jpg" onerror="this.onerror=null;this.src='/img/common/404.jpg'" alt="reptile-01"/></a><div class="content"><a class="title" href="/2023/05/16/reptile-01/" title="reptile-01">reptile-01</a><time datetime="2023-05-16T00:19:16.000Z" title="Created 2023-05-16 08:19:16">2023-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/14/Home-Credit-Default-Risk/" title="Home-Credit-Default-Risk"><img src="/img/cover/cover-11.jpeg" onerror="this.onerror=null;this.src='/img/common/404.jpg'" alt="Home-Credit-Default-Risk"/></a><div class="content"><a class="title" href="/2023/05/14/Home-Credit-Default-Risk/" title="Home-Credit-Default-Risk">Home-Credit-Default-Risk</a><time datetime="2023-05-14T10:36:42.000Z" title="Created 2023-05-14 18:36:42">2023-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/14/decision-tree/" title="decision-tree"><img src="/img/cover/cover-11.jpeg" onerror="this.onerror=null;this.src='/img/common/404.jpg'" alt="decision-tree"/></a><div class="content"><a class="title" href="/2023/05/14/decision-tree/" title="decision-tree">decision-tree</a><time datetime="2023-05-14T05:55:12.000Z" title="Created 2023-05-14 13:55:12">2023-05-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/OS/OS-1.jpeg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Confetti-lxy</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">世界很大,我想去看看</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>